## Create a Kubernetes cluster in Azure

> !! Bonus - Integrate AKS with KeyVault for keys, secrets & certificates !!\
[Integrate AKS cluster with Azure KeyVault!!](kv.md)\
Note: If you intend to do this integration, follow this before launching the AKS cluster.

**Generate SSH keys to be used for AKS worker nodes:**

    ssh-keygen -t rsa

**Find available AKS versions in your region:**

    az aks get-versions -l eastus -o table

>Explore contents of k8sDeploy & k8sDeploy.param.json in your favourite editor. Edit parameter values in k8sDeploy.param.json as needed.

>Note:\
>Use AKS version one older than the latest, as we'll try upgrading cluster later in the lab.\
>Use the content of .pub file generated by ssh-keygen in param.json

**Setup deployment variables for AKS:**
>Change templatePath and other values as per your environment

PowerShell:

    $resourceDeploymentName = 'demok8sdeploy'
    $templatePath = $env:SystemDrive + '\' + 'users' + '\' + 'demok8s'
    $templateFile = 'k8sDeploy.json'
    $templateParameterFile = 'k8sDeploy.param.json'
    $template = $templatePath + '\' + $templateFile
    $templateParameter = $templatePath + '\' + $templateParameterFile

Bash:

    resourceDeploymentName='demok8sdeploy'
    templatePath=$HOME/demok8s
    templateFile=k8sDeploy.json
    templateParameterFile=k8sDeploy.param.json
    template=$templatePath/$templateFile
    templateParameter=$templatePath/$templateParameterFile

**Launch AKS cluster deployment:**\
PowerShell:

    New-AzResourceGroupDeployment `
     -Name $resourceDeploymentName `
     -ResourceGroupName $resourceGroupName `
     -TemplateFile $template `
     -TemplateParameterFile $templateParameter `
     -Verbose -Force

Bash:

    ```az group deployment create \
    --name $resourceDeploymentName \
    --resource-group $resourceGroupName \
    --template-file $template \
    --parameters @$templateParameter \
    --no-wait ```

<br>
<br>
<br>
<br>

---
Continue to [Prepare container images](prepareimages.md) \
Back to [Create Azure Container Registry](acr.md) or to [Home](README.md)